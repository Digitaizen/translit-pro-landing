---
/**
 * Language dropdown component for switching between supported languages.
 * Matches the design from the TranslitPro app.
 */

import { languages, getLanguageByCode } from '../i18n/languages';
import { theme } from '../theme.config';

interface Props {
  currentLang: string;
}

const { currentLang } = Astro.props;
const currentLanguage = getLanguageByCode(currentLang) || languages[0];
---

<div class="relative language-dropdown">
  <button
    id="language-button"
    class={`flex items-center gap-2 px-3 py-2 text-sm font-medium text-${theme.colors.text.secondary} hover:text-${theme.colors.text.primary} transition-colors rounded-lg hover:bg-${theme.colors.background.elevated}/${theme.opacity.subtle}`}
    aria-label="Select language"
    aria-haspopup="true"
    aria-expanded="false"
  >
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
    </svg>
    <span class="hidden sm:inline">{currentLanguage.nativeName}</span>
    <svg class="w-4 h-4 transition-transform" id="chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
    </svg>
  </button>

  <div
    id="language-menu"
    class={`hidden absolute right-0 mt-2 w-96 bg-${theme.colors.background.elevated} border border-${theme.colors.border.default} rounded-lg shadow-xl z-50 p-3`}
    role="menu"
    aria-orientation="vertical"
  >
    <div class="grid grid-cols-3 gap-2">
      {languages.map((lang) => (
        <a
          href={lang.code === 'en' ? '/' : `/${lang.code}`}
          class:list={[
            "relative flex flex-col px-3 py-2 text-sm rounded-md transition-colors",
            currentLang === lang.code
              ? `bg-${theme.colors.primary.dark} text-${theme.colors.text.primary}`
              : `text-${theme.colors.text.secondary} hover:bg-${theme.colors.background.subtle} hover:text-${theme.colors.text.primary}`
          ]}
          role="menuitem"
          dir={lang.dir}
        >
          <div class="flex items-center justify-between w-full">
            <span class="font-medium">{lang.nativeName}</span>
            {currentLang === lang.code && (
              <svg class="w-4 h-4 flex-shrink-0 absolute top-2 right-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
            )}
          </div>
          <span class="text-xs opacity-60 mt-0.5">{lang.name}</span>
        </a>
      ))}
    </div>
  </div>
</div>

<script>
  const button = document.getElementById('language-button');
  const menu = document.getElementById('language-menu');
  const chevron = document.getElementById('chevron');

  function toggleMenu() {
    const isHidden = menu?.classList.contains('hidden');
    
    if (isHidden) {
      menu?.classList.remove('hidden');
      button?.setAttribute('aria-expanded', 'true');
      chevron?.classList.add('rotate-180');
    } else {
      menu?.classList.add('hidden');
      button?.setAttribute('aria-expanded', 'false');
      chevron?.classList.remove('rotate-180');
    }
  }

  function closeMenu() {
    menu?.classList.add('hidden');
    button?.setAttribute('aria-expanded', 'false');
    chevron?.classList.remove('rotate-180');
  }

  button?.addEventListener('click', (e) => {
    e.stopPropagation();
    toggleMenu();
  });

  // Close menu when clicking outside
  document.addEventListener('click', (e) => {
    if (!menu?.contains(e.target as Node) && !button?.contains(e.target as Node)) {
      closeMenu();
    }
  });

  // Close menu when pressing Escape
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      closeMenu();
    }
  });
</script>

<style>
  .language-dropdown {
    position: relative;
  }
</style>

